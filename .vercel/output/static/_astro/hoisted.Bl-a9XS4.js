import{c as w,m as p}from"./mapbox-gl.VWBwekGc.js";const D={"@@functional/placeholder":!0};function o(a){return a===D}function d(a){return function t(e){return arguments.length===0||o(e)?t:a.apply(this,arguments)}}function c(a){return function t(e,r){switch(arguments.length){case 0:return t;case 1:return o(e)?t:d(function(n){return a(e,n)});default:return o(e)&&o(r)?t:o(e)?d(function(n){return a(n,r)}):o(r)?d(function(n){return a(e,n)}):a(e,r)}}}function E(a){return function t(e,r,n){switch(arguments.length){case 0:return t;case 1:return o(e)?t:c(function(i,s){return a(e,i,s)});case 2:return o(e)&&o(r)?t:o(e)?c(function(i,s){return a(i,r,s)}):o(r)?c(function(i,s){return a(e,i,s)}):d(function(i){return a(e,r,i)});default:return o(e)&&o(r)&&o(n)?t:o(e)&&o(r)?c(function(i,s){return a(i,s,n)}):o(e)&&o(n)?c(function(i,s){return a(i,r,s)}):o(r)&&o(n)?c(function(i,s){return a(e,i,s)}):o(e)?d(function(i){return a(i,r,n)}):o(r)?d(function(i){return a(e,i,n)}):o(n)?d(function(i){return a(e,r,i)}):a(e,r,n)}}}const L=Array.isArray||function(t){return t!=null&&t.length>=0&&Object.prototype.toString.call(t)==="[object Array]"};function b(a,t){return function(){var e=arguments.length;if(e===0)return t();var r=arguments[e-1];return L(r)||typeof r[a]!="function"?t.apply(this,arguments):r[a].apply(r,Array.prototype.slice.call(arguments,0,e-1))}}var x=E(b("slice",function(t,e,r){return Array.prototype.slice.call(r,t,e)}));function y(a){return Object.prototype.toString.call(a)==="[object Number]"}var M=c(function(t,e){if(!(y(t)&&y(e)))throw new TypeError("Both arguments to range must be numbers");for(var r=Array(t<e?e-t:0),n=t<0?e+Math.abs(t):e-t,i=0;i<n;)r[i]=i+t,i+=1;return r}),I=c(function(t,e){if(t<=0)throw new Error("First argument to splitEvery must be a positive integer");for(var r=[],n=0;n<e.length;)r.push(x(n,n+=t,e));return r});const _=9;document.addEventListener("alpine:init",()=>{Alpine.store("filters",{category:"all",canton:"all",season:"all",duration:"all",currentPage:1,data:[],filteredData:[],pagedData:[],total:0,pagination:[],displayMap:!1,dispatch(){document.dispatchEvent(new CustomEvent("filtersUpdated",{detail:{filteredData:this.filteredData}}))},init(){this.data=JSON.parse(document.getElementById("balades")?.dataset?.data??"{}"),this.filteredData=[...this.data],this.updateFilteredData(),this.dispatch()},toggleMap(){this.displayMap=!this.displayMap},updateFilteredData(){this.filteredData=this.data.filter(a=>(this.category==="all"||this.category!=="all"&&a.data.category===this.category)&&(this.season==="all"||this.season!=="all"&&a.data.seasons.includes(this.season))&&(this.canton==="all"||this.canton!=="all"&&a.data.canton===this.canton)&&(this.duration==="all"||this.duration!=="all"&&this.duration.split(".")[0]<a.data.duration/60&&a.data.duration/60<=this.duration.split(".")[1])),this.updatePagedData(),this.dispatch()},updatePagedData(){const a=I(_,this.filteredData);this.pagedData=a[this.currentPage-1]??[],this.total=a.length,this.updatePagination()},updatePagination(){const t=this.currentPage-1,e=this.currentPage+1+1;let r;const n=[],i=M(1,this.total+1).filter(s=>s===1||s===this.total||s>=t&&s<e);for(const s of i)r&&s-r!==1&&n.push("..."),n.push(s),r=s;this.pagination=n},decrement(){this.currentPage=this.currentPage>1?this.currentPage-1:1,this.updatePagedData()},increment(){this.currentPage=this.currentPage<this.total?this.currentPage+1:this.total,this.updatePagedData()},setPage(a){this.currentPage=a,this.updatePagedData()},set(a,t){this[a]=t,this.currentPage=1,this.updateFilteredData()}})});function h(a){var t=[1/0,1/0,-1/0,-1/0];return w(a,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}h.default=h;let l;const g="pk.eyJ1IjoieWFnbyIsImEiOiJQaW1oanlrIn0.wyTDa-iIpoaRCRNd8oSHxQ",P="https://a.tiles.mapbox.com/v4/marker/pin",$={default:`${P}-l+1d4ed8.png?access_token=${g}`};let u;document.addEventListener("filtersUpdated",a=>{u={type:"FeatureCollection",features:a.detail.filteredData.map(t=>({type:"Feature",properties:{"marker-color":"#272E00","marker-symbol":t.data.category==="Histoire"?"castle":"park-alt1",icon:`large${t.data.category==="Histoire"?"castle":"park-alt1"}#272E00`,title:t.data.title,slug:t.slug},geometry:{type:"Point",coordinates:t.data.coordinates}}))},document.dispatchEvent(new CustomEvent("updateMap"))});const v=(a,t)=>{const e=a?.features?.reduce((r,n)=>{if(n.properties?.["marker-color"]!==void 0){const i=n.properties["marker-color"],s="large",f=n.properties["marker-symbol"],k=`${P}-${s.slice(0,1)}-${f}+${i.slice(1)}.png?access_token=${g}`,m=s+f+i;r[m]===void 0&&(r[m]=k)}return r},$);e!==void 0&&Object.keys(e).forEach((r,n)=>{l?.loadImage(e[r],(i,s)=>{if(i)throw i;s!==void 0&&!l?.hasImage(r)&&l?.addImage(r??"marker",s),n===Object.keys(e).length-1&&t()})})},j=async()=>{p.accessToken=g,l=new p.Map({center:[7.01867,46.54843],zoom:9,container:"map",style:"mapbox://styles/mapbox/outdoors-v12"});const a=t=>{t!==void 0&&(l.getSource("items")!==void 0&&(l.removeLayer("points"),l.removeSource("items")),l.addSource("items",{type:"geojson",data:u}),l.addLayer({id:"points",type:"symbol",source:"items",layout:{"icon-image":["get","icon"],"icon-allow-overlap":!0,"text-allow-overlap":!0,"symbol-z-order":"viewport-y","icon-size":.8}}))};l.addControl(new p.NavigationControl),l.on("load",async()=>{u!==null&&v(u,()=>{const[t,e,r,n]=h(u);l.fitBounds([[t,e],[r,n]]),a(u)}),document.addEventListener("updateMap",()=>{v(u,()=>{const[t,e,r,n]=h(u);l.fitBounds([[t,e],[r,n]]),a(u)})})}),l.on("click","points",t=>{const e=t.features[0].geometry.coordinates.slice(),{title:r}=t.features[0].properties,{slug:n}=t.features[0].properties;for(;Math.abs(t.lngLat.lng-e[0])>180;)e[0]+=t.lngLat.lng>e[0]?360:-360;new p.Popup({offset:[0,-40]}).setLngLat(e).setHTML(`
        <a href='${`/balades/${n}`}' class="hover:!underline underline-offset-4 decoration-2">
          <h3 class="w-10/12 font-serif text-lg font-bold leading-tight">
            ${r}
          </h3>
         </a>
      `).addTo(l)}),l.on("mouseenter","places",()=>{l.getCanvas().style.cursor="pointer"}),l.on("mouseleave","places",()=>{l.getCanvas().style.cursor=""})};j();
